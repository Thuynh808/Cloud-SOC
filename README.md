# Azure Live Traffic SOC & Honeynet Project
![Cloud Honeynet / SOC](https://i.imgur.com/6zgfR5R.png)

## Introduction

Within this project, I have developed a compact honeynet using Azure, where I integrate log sources from various origins into a dedicated Log Analytics workspace. This workspace serves as the foundation for Microsoft Sentinel, allowing the construction of attack maps, activation of alerts, and the generation of incidents. To assess the security aspects of the vulnerable environment, I gathered security metrics over a 24-hour period. After that, I implemented specific security controls to fortify the environment and evaluated the metrics for an additional 24 hours. The findings are presented below with the following metrics:

- SecurityEvent - Windows Event Logs
- Syslog - Linux Event Logs
- SecurityAlert - Log Analytics Alerts Triggered
- SecurityIncident - Incidents generated by Sentinel
- AzureNetworkAnalytics_CL - Identified Malicious Flows permitted into our honeynet.

The architecture of the mini honeynet in Azure has the following components:

- Virtual Network (VNet)
- Network Security Group (NSG)
- Virtual Machines (2 Windows, 1 Linux)
- Log Analytics Workspace
- Azure Key Vault
- Azure Storage Account
- Microsoft Sentinel
- [NIST SP 800-53 Revision 5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final) for Security Controls
- [NIST SP 800-61 Revision 2](https://www.nist.gov/privacy-framework/nist-sp-800-61) for Incident Handling Guidance

## Architecture Before Hardening / Security Controls
![Architecture Diagram](https://i.imgur.com/j9rsRIH.png)

Initially, for the "BEFORE" metrics, all resources were deployed and directly exposed to the internet. Both Virtual Machines had unrestricted Network Security Groups and open built-in firewalls, while other resources were set up with public endpoints, lacking the utilization of Private Endpoints.

## Architecture After Hardening / Security Controls
![Architecture Diagram](https://i.imgur.com/iMhHSHA.png)

In contrast, for the "AFTER" metrics, substantial security enhancements were implemented, resulting in improved overall security by mitigating vulnerabilities and safeguarding against unauthorized access and cyber threats. A series of comprehensive security measures were carefully deployed, with a strong focus on three key areas: 

- <b>Network Security Groups (NSGs)</b>: I hardened the NSGs by blocking all inbound and outbound traffic, with the sole exception of my own public IP address. This ensured that only authorized traffic from a trusted source was allowed to access the virtual machines.

- <b>Built-in Firewalls</b>: I secured the virtual machines by configuring their built-in firewalls. Fine-tuning the firewall rules for each entity reduced the potential attack surface.

- <b>Private Endpoints</b>: I improved security by replacing public endpoints with Private Endpoints for Azure resources. This restricted access to sensitive resources, protecting them from unauthorized access and potential threats.<br> 

## Attack Maps Before Hardening / Security Controls
> <b>NOTE:The attack maps were generated from a workbook using pre-built KQL .JSON map files, which also included geolocation data. These files provided structured representations of attack patterns and their data, allowing visualizations to illustrate cyber threats' geographic distribution and their impact on the system.</b>

![NSG Allowed Inbound Malicious Flows](https://i.imgur.com/XjOmjl9.jpg)
- The attack map highlights the risks of leaving the Network Security Group (NSG) open, stressing the importance of implementing proper security measures, such as restricting NSG rules, to minimize threats. <br><br>
![Windows RDP/SMB Auth Failures](https://i.imgur.com/V5r4Vst.jpg)<br> <br>
- The attack map shows numerous RDP and SMB failures, emphasizing the need to secure remote access and file sharing services against potential cyber threats. <br> <br>
![Linux Syslog Auth Failures](https://i.imgur.com/KEMHHmO.jpg) <br> <br>
- The attack map shows syslog authentication failures on the Linux server, underscoring the importance of securing it with strong authentication and vigilant log monitoring. <br> <br>

## Metrics Before Hardening / Security Controls

During a 24-hour period in our insecure environment, we gathered the following metrics:

- Start Time: 2023-07-12 08:51:28
- Stop Time: 2023-07-13 08:51:28

| Metric                   | Count |
| ------------------------ | ----- |
| SecurityEvent            | 3186  |
| Syslog                   | 967   |
| SecurityAlert            | 1     |
| SecurityIncident         | 253   |
| AzureNetworkAnalytics_CL | 1094  |

These metrics reflect the data we collected while exploring the vulnerable environment over the span of a day.

## Attack Maps After Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.```

## Metrics After Hardening / Security Controls

Below is the information detailing the metrics obtained from our environment for another 24-hour duration, but this time after implementing security controls:

- Start Time: 2023-07-18 08:37:38
- Stop Time: 2023-07-19 08:37:38

| Metric                   | Count |
| ------------------------ | ----- |
| SecurityEvent            | 658   |
| Syslog                   | 0     |
| SecurityAlert            | 0     |
| SecurityIncident         | 0     |
| AzureNetworkAnalytics_CL | 0     |

## Conclusion

Throughout this project, we successfully built a mini honeynet in Microsoft Azure and seamlessly integrated log sources into a Log Analytics workspace. Employing Microsoft Sentinel allowed us to promptly activate alerts and generate incidents based on the collected logs. We meticulously assessed the metrics within the insecure environment prior to implementing security controls, and then once more after applying the necessary measures. The results showcased a remarkable reduction in security events and incidents following the implementation of these security controls, affirming their effectiveness.


The comparison of pre- and post-implementation metrics demonstrated a significant reduction in security events and incidents, which highlights the effectiveness of the enforced security controls.
It's important to mention that if the network's resources were extensively engaged by regular users, it's plausible that a higher number of security events and alerts could have been produced within the 24-hour timeframe post-security control implementation.
